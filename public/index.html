<html>
    <head>
        <!-- Global site tag (gtag.js) - Google Analytics -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-180772922-1"></script>
        <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-180772922-1');
        </script>
        <meta property="og:title" content="COVID Red and Blue">
        <meta property="og:description" content="The virus is not partisan. Ignoring science can have tragic consequences.">
        <meta property="og:image" content="https://covidredandblue.com/images/thumbnail.jpg">
        <meta property="og:url" content="https://covidredandblue.com/index.html">
        <meta name="twitter:card" content="summary_large_image"> 
        <title>COVID Red and Blue | The virus is not partisan. Ignoring science can have tragic consequences. Here are the facts.</title>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css" integrity="sha512-NhSC1YmyruXifcj/KFRWoC561YpHpc5Jtzgvbuzx5VozKpWvQ+4nXhPdFgmx8xqexRcpAglTj9sIBWINXa8x5w==" crossorigin="anonymous" />
        <link async rel="stylesheet" href="https://cdn.jsdelivr.net/npm/semantic-ui@2.3.1/dist/semantic.min.css" />     
        <link rel="stylesheet" href="styles/application.css" rel='stylesheet' type='text/css' />
    </head>
    <body>
        <div id="root"></div>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/numeral.js/2.0.6/numeral.min.js"></script>
        <script src="https://unpkg.com/react@16.12.0/umd/react.production.min.js"></script>
        <script src="https://unpkg.com/react-dom@16.12.0/umd/react-dom.production.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js" integrity="sha512-qTXRIMyZIFb8iQcfjXWCO8+M5Tbc38Qi5WzdPOYZHIlZpzBHG3L3by84BBBOiRGiEb7KKtAOAs5qYdUiZiQNNQ==" crossorigin="anonymous"></script>
        <script src="https://unpkg.com/@babel/standalone@7.8.3/babel.js"></script>
        <script src="scripts/helper.js"></script>
        <script type="text/babel">
        function StatesTable({usRecordsData, showCasesOrDeaths, showPer100k}) {
            const sortStatesDataBy = (prop, ascending = true) => {
                const propSortOrder = (prop in statesDataSortOrder) ? {[prop]: !statesDataSortOrder[prop]} : {[prop]: ascending};
                setStatesDataSortOrder({...propSortOrder});
                let sortedData = [...statesData].sort((a, b) => a[prop] > b[prop] ? 1 : -1);
                if (propSortOrder[prop] == false) sortedData.reverse();
                setStatesData(sortedData);
            };
            const sortStatesDataByGovernmentBranch = prop => {
                const propSortOrder = (prop in statesDataSortOrder) ? {[prop]: !statesDataSortOrder[prop]} : {[prop]: true};
                setStatesDataSortOrder({...propSortOrder});
                let sortedData = [...statesData].sort((a, b) => a[prop] > b[prop] ? 1 : (a[prop] == b[prop]) ? ((a['Control'] > b['Control']) ? 1 : -1) : -1);
                if (propSortOrder[prop] == false) sortedData.reverse();
                setStatesData(sortedData);
            };
            const [statesData, setStatesData] = React.useState(usRecordsData);
            const [statesDataSortOrder, setStatesDataSortOrder] = React.useState({});
            if (Object.keys(statesDataSortOrder).length === 0) sortStatesDataBy('NewDeaths_7da_100k', false);
            const [show7DayAvg, setShow7DayAvg] = React.useState(true);
            const onClickShowSevenDayAvg = value => setShow7DayAvg(value); 
            const newCasesKey = getNewCasesKey(showPer100k, show7DayAvg);
            const newDeathsKey = getNewDeathsKey(showPer100k, show7DayAvg);
            const totalCasesKey = getTotalCasesKey(showPer100k);
            const totalDeathsKey = getTotalDeathsKey(showPer100k);
            const SelectSevenDayAverage = () => {
                return(<div id="sevenDayAverageMenu" class="ui buttons">
                        <button onClick={() => onClickShowSevenDayAvg(false)} 
                                class={`ui button`+(show7DayAvg == false ? ' active' : '')}>Today's Total</button>
                        <button onClick={() => onClickShowSevenDayAvg(true)} 
                                class={`ui button`+(show7DayAvg == true ? ' active' : '')}>7-day avg</button>
                      </div>)
            }
            const [pastNumberOfWeeks, setPastNumberOfWeeks] = React.useState('6');
            const onChangePastNumberOfWeeks = event => setPastNumberOfWeeks(event.target.value);
            const newCasesPrevWeeksKey = getNewCasesPrevWeeksKey(pastNumberOfWeeks, showPer100k);
            const newDeathsPrevWeeksKey = getNewDeathsPrevWeeksKey(pastNumberOfWeeks, showPer100k);
            const newCasesNextWeeksKey = getNewCasesNextWeeksKey(pastNumberOfWeeks, showPer100k);
            const newDeathsNextWeeksKey = getNewDeathsNextWeeksKey(pastNumberOfWeeks, showPer100k);
            const SelectPastNumberOfWeeks = () => {
                return(<select class="ui dropdown" onChange={onChangePastNumberOfWeeks} value={pastNumberOfWeeks}>
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                        <option value="6">6</option>
                       </select>
                )
            }
            const [showRepublicanGovernors, setShowRepublicanGovernors] = React.useState(true);
            const [showDemocratGovernors, setShowDemocratGovernors] = React.useState(true);
            const [showRepublicanLegislatures, setShowRepublicanLegislatures] = React.useState(true);
            const [showDemocratLegislatures, setShowDemocratLegislatures] = React.useState(true);
            const govtRowShowHideInfo = {showRepublicanGovernors, showDemocratGovernors, showDemocratLegislatures, showRepublicanLegislatures}

            const [statePage, setStatePage] = React.useState({number: 1, start: 0, end: 11});
            const onClickSetPage = (number, start, end) => setStatePage({number: number, start: start, end: end}); 
            const visibleRecords = statesData.filter(record => govtRowShowHide(record, govtRowShowHideInfo));
            let rowNum = statePage.start;
            const statesRows = visibleRecords.slice(statePage.start, statePage.end+1).map((record) => { 
                rowNum += 1;
                const governorColor = getRowColorForGovernor(record);
                const legislatureColor = getRowColorForLegislature(record);
                return(
                    <tr key={record["State"]} className={rowClassForPartyControl(record["Control"])}>
                        <th className="rowNum">{rowNum}</th>
                        <th style={{width: '100px'}} className="stateName">
                            <div>{record["State"]}</div>
                            <div className="populationLabel">Pop. <span className="populationNumber">{formatNumber(record["Population"],'0,0')}</span></div>
                        </th>
                        <td style={{borderLeft: 'none'}} className="governmentBranch">
                            <i aria-hidden="true" class={`${governorColor}Governor user big icon` + (record['Governor'] == 'NA' ? ' hidden' : '')}></i>
                            <i aria-hidden="true" class={`${legislatureColor}Legislature university big icon` + (record['Legislature'] == 'NA' ? ' hidden' : '')}></i>
                        </td>
                        <td className={'center aligned colCellDeaths ' + showOrHideDeaths(showCasesOrDeaths)}>{formatNumber(record[newDeathsKey],'0,0')}</td>
                        <td className={'center aligned colCellCases ' + showOrHideCases(showCasesOrDeaths)}>{formatNumber(record[newCasesKey],'0,0')}</td>
                        <td className={'center aligned colCellDeaths ' + showOrHideDeaths(showCasesOrDeaths)}>{formatNumber(record[newDeathsPrevWeeksKey],'0,0')}</td>
                        <td className={'center aligned colCellCases ' + showOrHideCases(showCasesOrDeaths)}>{formatNumber(record[newCasesPrevWeeksKey],'0,0')}</td>
                        <td className={'center aligned colCellDeaths ' + showOrHideDeaths(showCasesOrDeaths)}>{formatNumber(record[newDeathsNextWeeksKey],'0,0')}</td>
                        <td className={'center aligned colCellCases ' + showOrHideCases(showCasesOrDeaths)}>{formatNumber(record[newCasesNextWeeksKey],'0,0')}</td>
                        <td className={'center aligned colCellDeaths ' + showOrHideDeaths(showCasesOrDeaths)}>{formatNumber(record[totalDeathsKey],'0,0')}</td>
                        <td className={'center aligned colCellCases ' + showOrHideCases(showCasesOrDeaths)}>{formatNumber(record[totalCasesKey],'0,0')}</td>
                    </tr>); 
            }); 

            const onClickShowRepublicanGovernors = () => { 
                setShowRepublicanGovernors(!showRepublicanGovernors);
                setStatePage({number: 1, start: 0, end: 11});
            }
            const onClickShowDemocratGovernors = () => {
                setShowDemocratGovernors(!showDemocratGovernors);
                setStatePage({number: 1, start: 0, end: 11});
            }
            const onClickShowRepublicanLegislatures = () => {
                setShowRepublicanLegislatures(!showRepublicanLegislatures);
                setStatePage({number: 1, start: 0, end: 11});
            }
            const onClickShowDemocratLegislatures = () => {
                setShowDemocratLegislatures(!showDemocratLegislatures);
                setStatePage({number: 1, start: 0, end: 11});
            }
            const SortIcon = ({colName, sortOrder, arrowStyle = 'amount'}) => {
                let classes = 'sort icon disabled';
                if (sortOrder.hasOwnProperty(colName)) {
                    if (sortOrder[colName] == true) {
                        classes = 'sort icon up';
                    }
                    else if (sortOrder[colName] == false) {
                        classes = 'sort icon down';
                    } 
                }  
                return(<i style={{textDecoration: 'none'}} className={classes}></i>); 
            }

            return (
                <div>
                    <div className="ui pagination menu">
                        {(visibleRecords.length > 0) ? <a onClick={() => onClickSetPage(1,0,11)} className={'item' + (statePage.number == 1 ? ' active' : '')}>1</a> : ''}
                        {(visibleRecords.length > 12) ? <a onClick={() => onClickSetPage(2,12,23)} className={'item' + (statePage.number == 2 ? ' active' : '')}>2</a> : ''}
                        {(visibleRecords.length > 24) ? <a onClick={() => onClickSetPage(3,24,35)} className={'item' + (statePage.number == 3 ? ' active' : '')}>3</a> : ''}
                        {(visibleRecords.length > 36) ? <a onClick={() => onClickSetPage(4,36,47)} className={'item' + (statePage.number == 4 ? ' active' : '')}>4</a> : ''}
                        {(visibleRecords.length > 48) ? <a onClick={() => onClickSetPage(5,48,59)} className={'item' + (statePage.number == 5 ? ' active' : '')}>5</a> : ''}
                    </div>
                <table className="ui celled table unstackable">
                    <thead>
                        <tr>
                            <th style={{width: '100px', textAlign: 'left', paddingLeft: '5px'}} colSpan="2" rowSpan="2">
                                <div>
                                    <div style={{marginBottom: '5px'}}><a class="ui label" style={{paddingLeft: '0px', fontSize: '14px', fontWeight: 'strong !important'}} onClick={() => sortStatesDataBy("State", true)}><SortIcon colName='State' sortOrder={statesDataSortOrder} />State</a> </div>
                                    <div><span style={{fontWeight: 'normal', fontSize: '0.85em'}}><a style={{paddingLeft: '0px',paddingTop:'3px'}}class="ui label" onClick={() => sortStatesDataBy("Population", true)}><SortIcon colName='Population' sortOrder={statesDataSortOrder} />Population</a></span></div>
                                </div>
                            </th>
                            <th style={{borderLeft: 'none'}} rowSpan="2">
                                <div>
                                    <div style={{marginBottom: '5px'}}>
                                        <a id="governorLabel" class="ui label" onClick={() => sortStatesDataByGovernmentBranch("Governor")}>
                                            <SortIcon colName='Governor' sortOrder={statesDataSortOrder} /><i class="user icon"></i>Governor
                                        </a>
                                        <span style={{marginLeft: '8px'}} class="ui buttons">
                                            <button onClick={onClickShowDemocratGovernors} style={{fontSize: '10px'}} class={`govt democrat ui button` + (showDemocratGovernors == true ? ' active' : ' inactive')}>D</button>
                                            <button onClick={onClickShowRepublicanGovernors} style={{fontSize: '10px'}} class={`govt republican ui button` + (showRepublicanGovernors == true ? ' active' : ' inactive')}>R</button>
                                        </span>
                                    </div>
                                    <div>
                                        <a id="legislatureLabel" class="ui label" onClick={() => sortStatesDataByGovernmentBranch("Legislature")}>
                                            <SortIcon colName='Legislature' sortOrder={statesDataSortOrder} /><i class="university icon"></i>Legislature
                                        </a>
                                        <span class="ui buttons">
                                            <button onClick={onClickShowDemocratLegislatures} style={{fontSize: '10px'}} class={`govt democrat ui button` + (showDemocratLegislatures == true ? ' active' : ' inactive')}>D</button>
                                            <button onClick={onClickShowRepublicanLegislatures} style={{fontSize: '10px'}} class={`govt republican ui button` + (showRepublicanLegislatures == true ? ' active' : ' inactive')}>R</button>
                                        </span>
                                    </div>
                                </div>
                            </th>
                            <th className="colHeadsOne center aligned" colSpan={colSpanCasesAndDeaths(showCasesOrDeaths)}><div style={{marginBottom: '3px'}}>Daily New</div> <div><SelectSevenDayAverage /></div></th>
                            <th className="colHeadsOne center aligned" colSpan={colSpanCasesAndDeaths(showCasesOrDeaths)}>Past <SelectPastNumberOfWeeks /> Week{pastNumberOfWeeks > 1 ? 's' : ''}</th>
                            <th className="colHeadsOne center aligned" colSpan={colSpanCasesAndDeaths(showCasesOrDeaths)}>Next {pastNumberOfWeeks} Week{pastNumberOfWeeks > 1 ? 's' : ''}</th>
                            <th className="colHeadsOne center aligned" colSpan={colSpanCasesAndDeaths(showCasesOrDeaths)}>Total to Date</th>
                        </tr>
                        <tr>
                            <th className={'center aligned colHeadsDeaths ' + showOrHideDeaths(showCasesOrDeaths)}>
                                <a onClick={() => sortStatesDataBy(newDeathsKey, false)}><SortIcon colName={newDeathsKey} sortOrder={statesDataSortOrder} />Deaths</a>
                            </th>
                            <th style={{borderLeft: '1px dotted #E1E1E1'}} className={'center aligned colHeadsCases ' + showOrHideCases(showCasesOrDeaths)}>
                                <a onClick={() => sortStatesDataBy(newCasesKey, false)}><SortIcon colName={newCasesKey} sortOrder={statesDataSortOrder} />Cases</a>
                            </th>

                            <th className={'center aligned colHeadsDeaths ' + showOrHideDeaths(showCasesOrDeaths)}>
                                <a onClick={() => sortStatesDataBy(newDeathsPrevWeeksKey, false)}><SortIcon colName={newDeathsPrevWeeksKey} sortOrder={statesDataSortOrder} />Deaths</a>
                            </th>
                            <th className={'center aligned colHeadsCases ' + showOrHideCases(showCasesOrDeaths)}>
                                <a onClick={() => sortStatesDataBy(newCasesPrevWeeksKey, false)}><SortIcon colName={newCasesPrevWeeksKey} sortOrder={statesDataSortOrder} />Cases</a>
                            </th>

                            <th className={'center aligned colHeadsDeaths ' + showOrHideDeaths(showCasesOrDeaths)}>
                                <a onClick={() => sortStatesDataBy(newDeathsNextWeeksKey, false)}><SortIcon colName={newDeathsNextWeeksKey} sortOrder={statesDataSortOrder} />Deaths</a>
                            </th>
                            <th className={'center aligned colHeadsCases ' + showOrHideCases(showCasesOrDeaths)}>
                                <a onClick={() => sortStatesDataBy(newCasesNextWeeksKey, false)}><SortIcon colName={newCasesNextWeeksKey} sortOrder={statesDataSortOrder} />Cases</a>
                            </th>

                            <th className={'center aligned colHeadsDeaths ' + showOrHideDeaths(showCasesOrDeaths)}>
                                <a onClick={() => sortStatesDataBy(totalDeathsKey, false)}><SortIcon colName={totalDeathsKey} sortOrder={statesDataSortOrder} />Deaths</a>
                            </th>
                            <th className={'center aligned colHeadsCases ' + showOrHideCases(showCasesOrDeaths)}>
                                <a onClick={() => sortStatesDataBy(totalCasesKey, false)}><SortIcon colName={totalCasesKey} sortOrder={statesDataSortOrder} />Cases</a>
                            </th>

                        </tr>                      
                    </thead>
                    <tbody>
                        {statesRows}
                    </tbody>
                </table>
                <div className="ui pagination menu">
                    {(visibleRecords.length > 0) ? <a onClick={() => onClickSetPage(1,0,11)} className={'item' + (statePage.number == 1 ? ' active' : '')}>1</a> : ''}
                    {(visibleRecords.length > 12) ? <a onClick={() => onClickSetPage(2,12,23)} className={'item' + (statePage.number == 2 ? ' active' : '')}>2</a> : ''}
                    {(visibleRecords.length > 24) ? <a onClick={() => onClickSetPage(3,24,35)} className={'item' + (statePage.number == 3 ? ' active' : '')}>3</a> : ''}
                    {(visibleRecords.length > 36) ? <a onClick={() => onClickSetPage(4,36,47)} className={'item' + (statePage.number == 4 ? ' active' : '')}>4</a> : ''}
                    {(visibleRecords.length > 48) ? <a onClick={() => onClickSetPage(5,48,59)} className={'item' + (statePage.number == 5 ? ' active' : '')}>5</a> : ''}
                </div>
            </div>
            )
        }

        function App () {

            // Components
            const Heading1 = () => {
                return(<h1 class="ui header">
                        <span style={{marginRight: '10px'}}>COVID <span style={{color: "red"}}>Red</span> and <span style={{color: "blue"}}>Blue</span></span>
                        <span class="ui green label">Data as of {moment(usRecordsData[0]['Date']).format('LL')}</span>
                        </h1>);
            }

            const [casesOrDeaths, setCasesOrDeaths] = React.useState('casesAndDeaths');
            const onClickCasesOrDeaths = (value) => setCasesOrDeaths(value)

            const SelectCasesOrDeaths = () => {
                return(
                        <div class="ui buttons" style={{marginRight: '10px', marginBottom: '10px'}}>
                            <button onClick={() => onClickCasesOrDeaths('casesAndDeaths')} 
                                class={`ui button`+(casesOrDeaths == 'casesAndDeaths' ? ' active' : '')}>Deaths and Cases</button>
                            <button onClick={() => onClickCasesOrDeaths('deaths')} 
                                class={`ui button`+(casesOrDeaths == 'deaths' ? ' active' : '')}>Deaths Only</button>                            
                            <button onClick={() => onClickCasesOrDeaths('cases')} 
                                class={`ui button`+(casesOrDeaths == 'cases' ? ' active' : '')}>Cases Only</button>
                        </div>);
            }

            const [showPer100k, setShowPer100k] = React.useState(true);
            const onClickShowPer100k = value => setShowPer100k(value);
            const SelectShowPer100k = value => {
                return(
                    <div class="ui buttons">
                        <button onClick={() => onClickShowPer100k(true)} 
                                class={`ui button`+(showPer100k == true ? ' active' : '')}>Per 100k</button>
                        <button onClick={() => onClickShowPer100k(false)} 
                                class={`ui button`+(showPer100k == false ? ' active' : '')}>Raw Total</button>
                    </div>
                )
            }
            const onClickReset = () => window.location.reload();         

            // Get the data

            const [error, setError] = React.useState(null);
            const [isLoaded, setIsLoaded] = React.useState(false);
            const [usRecordsData, setUsRecordsData] = React.useState({});

            React.useEffect(() => {
                fetch(`data/us_records.json?r=${Math.random()}`)
                .then(res => res.json())
                .then(
                    (result) => {
                        setIsLoaded(true);
                        setUsRecordsData(result);
                    },
                (error) => {
                    setIsLoaded(true);
                    setError(error);
                })
            }, [])

            if (error) {
                return <div>Error: {error.message}</div>
            }
            else if (!isLoaded || (usRecordsData[0] === undefined)) {
                return (<>Loading...</>)
            }
            else {
                return(
                        <>
                            <Heading1 /> 
                            <h4>The virus is not partisan. Ignoring science can have tragic consequences.</h4> <p>Here are the facts, sorted by 7-day average deaths per 100K population. You can change the sorting.</p>
                            <SelectCasesOrDeaths /><SelectShowPer100k /><button onClick={onClickReset} style={{float: 'right'}} className='ui button'>Reset</button>
                            <StatesTable 
                                usRecordsData={usRecordsData}
                                showCasesOrDeaths={casesOrDeaths} 
                                showPer100k={showPer100k} />
                        </>
                );
            }
        }
        

        ReactDOM.render(<App />, document.getElementById('root'));
        </script>
        <!-- The core Firebase JS SDK is always required and must be listed first -->
        <script src="/__/firebase/7.22.1/firebase-app.js"></script>

        <!-- TODO: Add SDKs for Firebase products that you want to use
     https://firebase.google.com/docs/web/setup#available-libraries -->
        <script src="/__/firebase/7.22.1/firebase-analytics.js"></script>

        <!-- Initialize Firebase -->
        <script src="/__/firebase/init.js"></script>
    </body>
</html>