<html>
    <head>
        
        <title>COVID Red and Blue | COVID-19 Cases and Deaths by State Goverment Party Control</title>
        <link href='https://fonts.googleapis.com/css?family=Raleway:400,300,600' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css" integrity="sha512-NhSC1YmyruXifcj/KFRWoC561YpHpc5Jtzgvbuzx5VozKpWvQ+4nXhPdFgmx8xqexRcpAglTj9sIBWINXa8x5w==" crossorigin="anonymous" />
        <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/skeleton/2.0.4/skeleton.min.css" integrity="sha512-EZLkOqwILORob+p0BXZc+Vm3RgJBOe1Iq/0fiI7r/wJgzOFZMlsqTa29UEl6v6U6gsV4uIpsNZoV32YZqrCRCQ==" crossorigin="anonymous" /> -->
        <link async rel="stylesheet" href="https://cdn.jsdelivr.net/npm/semantic-ui@2.3.1/dist/semantic.min.css" />     
        <link rel="stylesheet" href="styles/application.css" rel='stylesheet' type='text/css' />
    </head>
    <body>
	<!-- Testing deployment -->
        <div id="root"></div>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/numeral.js/2.0.6/numeral.min.js"></script>
        <script src="https://unpkg.com/react@16.12.0/umd/react.production.min.js"></script>
        <script src="https://unpkg.com/react-dom@16.12.0/umd/react-dom.production.min.js"></script>
        <!-- <script async src="https://cdn.jsdelivr.net/npm/semantic-ui@2.3.1/dist/semantic.min.js"></script>  --> 
        <script src="https://unpkg.com/@babel/standalone@7.8.3/babel.js"></script>
        <script src="scripts/App.js"></script>
        <script src="scripts/helper.js"></script>
        <script src="data/us_records.json"></script>
        <script type="text/babel">
        function StatesTable({showCasesOrDeaths, governmentBranch, nextNumberOfWeeks, showPer100k, show7DayAvg}) {
            const [statesData, setStatesData] = React.useState(US_RECORDS);
            const [statesDataSortOrder, setStatesDataSortOrder] = React.useState({});
            const newCasesNextWeeksKey = getNewCasesNextWeeksKey(nextNumberOfWeeks, showPer100k);
            const newDeathsNextWeeksKey = getNewDeathsNextWeeksKey(nextNumberOfWeeks, showPer100k);
            const newCasesKey = getNewCasesKey(showPer100k, show7DayAvg);
            const newDeathsKey = getNewDeathsKey(showPer100k, show7DayAvg);
            const newCasesPrev6WeeksKey = getNewCasesPrev6WeeksKey(showPer100k);
            const newDeathsPrev6WeeksKey = getNewDeathsPrev6WeeksKey(showPer100k);
            const totalCasesKey = getTotalCasesKey(showPer100k);
            const totalDeathsKey = getTotalDeathsKey(showPer100k);
            const statesRows = statesData.map((record) => { 
                return(
                    <tr key={record["State"]} className={rowClassForPartyControl(record["Control"])}>
                        <th className="stateName">
                            <div>{record["State"]}</div>
                            <div className="populationLabel">Pop. <span className="populationNumber">{formatNumber(record["Population"],'0,0')}</span></div>
                        </th>
                        <td className={'colCellCases ' + showOrHideCases(showCasesOrDeaths)}>{formatNumber(record[newCasesKey],'0,0.00')}</td>
                        <td className={'colCellDeaths ' + showOrHideDeaths(showCasesOrDeaths)}>{formatNumber(record[newDeathsKey],'0,0.00')}</td>
                        <td className={'colCellCases ' + showOrHideCases(showCasesOrDeaths)}>{formatNumber(record[newCasesPrev6WeeksKey],'0,0.00')}</td>
                        <td className={'colCellDeaths ' + showOrHideDeaths(showCasesOrDeaths)}>{formatNumber(record[newDeathsPrev6WeeksKey],'0,0.00')}</td>
                        <td className={'colCellCases ' + showOrHideCases(showCasesOrDeaths)}>{formatNumber(record[newCasesNextWeeksKey],'0,0.00')}</td>
                        <td className={'colCellDeaths ' + showOrHideDeaths(showCasesOrDeaths)}>{formatNumber(record[newDeathsNextWeeksKey],'0,0.00')}</td>
                        <td className={'colCellCases ' + showOrHideCases(showCasesOrDeaths)}>{formatNumber(record[totalCasesKey],'0,0.00')}</td>
                        <td className={'colCellDeaths ' + showOrHideDeaths(showCasesOrDeaths)}>{formatNumber(record[totalDeathsKey],'0,0.00')}</td>
                        <td>{record[governmentBranch]}</td>
                    </tr>); 
            });
            const sortStatesDataBy = (prop, ascending = true) => {
                const propSortOrder = (prop in statesDataSortOrder) ? {[prop]: !statesDataSortOrder[prop]} : {[prop]: ascending};
                setStatesDataSortOrder({...statesDataSortOrder, ...propSortOrder});
                let sortedData = [...statesData].sort((a, b) => a[prop] > b[prop] ? 1 : -1);
                if (propSortOrder[prop] == false) sortedData.reverse();
                setStatesData(sortedData);
            };
            const sortStatesDataByGovernmentBranch = prop => {
                const propSortOrder = (prop in statesDataSortOrder) ? {[prop]: !statesDataSortOrder[prop]} : {[prop]: true};
                setStatesDataSortOrder({...statesDataSortOrder, ...propSortOrder});
                let sortedData = [...statesData].sort((a, b) => a[prop] > b[prop] ? 1 : (a[prop] == b[prop]) ? ((a['Control'] > b['Control']) ? 1 : -1) : -1);
                if (propSortOrder[prop] == false) sortedData.reverse();
                setStatesData(sortedData);
            };
            return (
                <table className="ui celled table">
                    <thead>
                        <tr>
                            <th style={{textAlign: 'left', paddingLeft: '5px'}} rowSpan="2">
                                <div>
                                    <div><a onClick={() => sortStatesDataBy("State", false)}>State</a> </div>
                                    <div><span style={{fontWeight: 'normal', fontSize: '0.85em'}}><a onClick={() => sortStatesDataBy("Population")}>Population</a></span></div>
                                </div>
                            </th>
                            <th className="colHeadsOne" colSpan={colSpanCasesAndDeaths(showCasesOrDeaths)}>Daily New</th>
                            <th className="colHeadsOne" colSpan={colSpanCasesAndDeaths(showCasesOrDeaths)}>Past 6 Weeks</th>
                            <th className="colHeadsOne" colSpan={colSpanCasesAndDeaths(showCasesOrDeaths)}>Next {nextNumberOfWeeks} Week{nextNumberOfWeeks > 1 ? 's' : ''}</th>
                            <th className="colHeadsOne" colSpan={colSpanCasesAndDeaths(showCasesOrDeaths)}>Total to Date</th>
                            <th rowSpan="2"><a onClick={() => sortStatesDataByGovernmentBranch(governmentBranch)}>{governmentBranch}</a></th>
                        </tr>
                        <tr>
                            <th className={'colHeadsCases ' + showOrHideCases(showCasesOrDeaths)}>
                                <a onClick={() => sortStatesDataBy(newCasesKey)}>Cases</a>
                            </th>
                            <th className={'colHeadsDeaths ' + showOrHideDeaths(showCasesOrDeaths)}>
                                <a onClick={() => sortStatesDataBy(newDeathsKey)}>Deaths</a>
                            </th>
                            <th className={'colHeadsCases ' + showOrHideCases(showCasesOrDeaths)}>
                                <a onClick={() => sortStatesDataBy(newCasesPrev6WeeksKey)}>Cases</a>
                            </th>
                            <th className={'colHeadsDeaths ' + showOrHideDeaths(showCasesOrDeaths)}>
                                <a onClick={() => sortStatesDataBy(newDeathsPrev6WeeksKey)}>Deaths</a>
                            </th>
                            <th className={'colHeadsCases ' + showOrHideCases(showCasesOrDeaths)}>
                                <a onClick={() => sortStatesDataBy(newCasesNextWeeksKey)}>Cases</a>
                            </th>
                            <th className={'colHeadsDeaths ' + showOrHideDeaths(showCasesOrDeaths)}>
                                <a onClick={() => sortStatesDataBy(newDeathsNextWeeksKey)}>Deaths</a>
                            </th>
                            <th className={'colHeadsCases ' + showOrHideCases(showCasesOrDeaths)}>
                                <a onClick={() => sortStatesDataBy(totalCasesKey)}>Cases</a>
                            </th>
                            <th className={'colHeadsDeaths ' + showOrHideDeaths(showCasesOrDeaths)}>
                                <a onClick={() => sortStatesDataBy(totalDeathsKey)}>Deaths</a>
                            </th>
                        </tr>                      
                    </thead>
                    <tbody>
                        {statesRows}
                    </tbody>
                </table>
            )
        }
        function App () {

            const Heading1 = () => <h1>COVID <span style={{color: "red"}}>Red</span> and <span style={{color: "blue"}}>Blue</span></h1>;

            const [casesOrDeaths, setCasesOrDeaths] = React.useState('casesAndDeaths');
            const onClickCasesOrDeaths = (value) => setCasesOrDeaths(value)

            const SelectCasesOrDeaths = () => {
                return(
                        <div class="ui buttons">
                            <button onClick={() => onClickCasesOrDeaths('casesAndDeaths')} 
                                class={`ui button`+(casesOrDeaths == 'casesAndDeaths' ? ' active' : '')}>Cases and Deaths</button>
                            <button onClick={() => onClickCasesOrDeaths('cases')} 
                                class={`ui button`+(casesOrDeaths == 'cases' ? ' active' : '')}>Cases Only</button>
                            <button onClick={() => onClickCasesOrDeaths('deaths')} 
                                class={`ui button`+(casesOrDeaths == 'deaths' ? ' active' : '')}>Deaths Only</button>
                        </div>
);
            }

            const [showPer100k, setShowPer100k] = React.useState(false);
            // const onChangePer100k = event => setShowPer100k(event.target.checked);
            // const CheckboxPer100k = () => {
            //     return(<fieldset>
            //                 <label style={{float: 'right', paddingLeft: '3px'}} htmlFor="CheckboxPer100k">per 100K</label>
            //                 <input id="CheckboxPer100k" onChange={onChangePer100k} type="checkbox" checked={showPer100k} />
            //             </fieldset>)
            // }

            const onClickShowPer100k = value => setShowPer100k(value);
            const SelectShowPer100k = value => {
                return(
                    <div class="ui buttons">
                        <button onClick={() => onClickShowPer100k(true)} 
                                class={`ui button`+(showPer100k == true ? ' active' : '')}>Per 100k</button>
                        <button onClick={() => onClickShowPer100k(false)} 
                                class={`ui button`+(showPer100k == false ? ' active' : '')}>Raw Total</button>
                    </div>
                )
            }

            const [governmentBranch, setGovernmentBranch] = React.useState('Governor');
            const onChangeGovernmentBranch = event => setGovernmentBranch(event.target.value);
            const SelectGovernmentBranch = () => {
                return(
                    <fieldset>
                        <label style={{paddingLeft:'0px'}} htmlFor="SelectGovernmentBranch">by political party of</label>
                        <select id="SelectGovernmentBranch" onChange={onChangeGovernmentBranch} value={governmentBranch}>
                            <option value="Governor">Governor</option>
                            <option value="Legislature">State Legislature</option>
                        </select>
                    </fieldset>
                )
            }
            const [nextNumberOfWeeks, setNextNumberOfWeeks] = React.useState('1');
            const onChangeNextNumberOfWeeks = event => setNextNumberOfWeeks(event.target.value);
            const SelectNextNumberOfWeeks = () => {
                return(
                    <fieldset style={{paddingRight: '10px'}}>
                        <label style={{paddingLeft: '0px'}} htmlFor="SelectNextNumberOfWeeks">for next</label>
                        <select id="SelectNextNumberOfWeeks" onChange={onChangeNextNumberOfWeeks} value={nextNumberOfWeeks}>
                            <option value="1">1 week</option>
                            <option value="2">2 weeks</option>
                            <option value="3">3 weeks</option>
                            <option value="4">4 weeks</option>
                            <option value="5">5 weeks</option>
                            <option value="6">6 weeks</option>
                        </select>
                    </fieldset>
                )
            }
            // const [showPer100k, setShowPer100k] = React.useState(false);
            // const onChangePer100k = event => setShowPer100k(event.target.checked);
            // const CheckboxPer100k = () => {
            //     return(<fieldset>
            //                 <label style={{float: 'right', paddingLeft: '3px'}} htmlFor="CheckboxPer100k">per 100K</label>
            //                 <input id="CheckboxPer100k" onChange={onChangePer100k} type="checkbox" checked={showPer100k} />
            //             </fieldset>)
            // }
            const [show7DayAvg, setShow7DayAvg] = React.useState(false);
            const onChange7DayAvg = event => setShow7DayAvg(event.target.checked);
            const Checkbox7DayAvg = () => {
                return(<fieldset>
                            <label style={{float: 'right', paddingLeft: '3px'}} htmlFor="Checkbox7DayAvg">7-day average</label>
                            <input id="Checkbox7DayAvg" onChange={onChange7DayAvg} type="checkbox" checked={show7DayAvg} />
                        </fieldset>)
            }

            // return (<>
            //             <Heading1 />
            //             <SelectCasesOrDeaths /><SelectGovernmentBranch /><SelectNextNumberOfWeeks /><CheckboxPer100k /><Checkbox7DayAvg />
            //             <StatesTable 
            //                 showCasesOrDeaths={casesOrDeaths} 
            //                 governmentBranch={governmentBranch} 
            //                 nextNumberOfWeeks={nextNumberOfWeeks}
            //                 showPer100k={showPer100k} show7DayAvg={show7DayAvg} />
            //         </>)

            return (<>
                        <Heading1 />
                        <SelectCasesOrDeaths /><SelectShowPer100k />
                        <StatesTable 
                            showCasesOrDeaths={casesOrDeaths} 
                            governmentBranch={governmentBranch} 
                            nextNumberOfWeeks={nextNumberOfWeeks}
                            showPer100k={showPer100k} show7DayAvg={show7DayAvg} />
                    </>)
        }
        ReactDOM.render(<App />, document.getElementById('root'));
        </script>
        <!-- The core Firebase JS SDK is always required and must be listed first -->
        <script src="/__/firebase/7.22.1/firebase-app.js"></script>

        <!-- TODO: Add SDKs for Firebase products that you want to use
     https://firebase.google.com/docs/web/setup#available-libraries -->
        <script src="/__/firebase/7.22.1/firebase-analytics.js"></script>

        <!-- Initialize Firebase -->
        <script src="/__/firebase/init.js"></script>
    </body>
</html>
